(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{4730:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return n(2963)}])},2963:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var a=n(5893),s=n(7294),i=n(1163),l=n(6808),o=n.n(l),r=n(8773),c=e=>{let{data:t,table:n,onEdit:s,onDelete:i}=e;return Array.isArray(t)&&0!==t.length?(0,a.jsx)("div",{className:o().tableContainer,children:(0,a.jsx)("div",{className:o().tableWrapper,children:(0,a.jsxs)("table",{className:o().table,children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"STT"}),"times"===n||"majors"===n||"technologies"===n||"impacts"===n||"outlines"===n?(0,a.jsxs)(a.Fragment,{children:["outlines"===n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("th",{children:"Bước"}),(0,a.jsx)("th",{children:"Thời gian"}),(0,a.jsx)("th",{children:"Ti\xeau đề"}),(0,a.jsx)("th",{children:"Emoji"})]}),"outlines"!==n&&(0,a.jsx)("th",{children:"times"===n?"Thời điểm":"majors"===n?"Ng\xe0nh":"technologies"===n?"C\xf4ng nghệ":"impacts"===n?"T\xe1c động":""})]}):null,(0,a.jsx)("th",{children:"Thao t\xe1c"})]})}),(0,a.jsx)("tbody",{children:t.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:t+1}),"times"===n||"majors"===n||"technologies"===n||"impacts"===n||"outlines"===n?(0,a.jsxs)(a.Fragment,{children:["outlines"===n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("td",{children:e.step}),(0,a.jsx)("td",{children:e.time}),(0,a.jsx)("td",{children:e.title}),(0,a.jsx)("td",{children:e.emoji?(0,a.jsx)("span",{style:{fontSize:"20px"},children:e.emoji}):"-"})]}),"outlines"!==n&&(0,a.jsx)("td",{children:e.title})]}):null,(0,a.jsxs)("td",{className:o().actionCell,children:[(0,a.jsxs)("button",{className:o().editButton,onClick:()=>s(e),children:[(0,a.jsx)(r.fmQ,{className:o().buttonIcon})," Sửa"]}),(0,a.jsxs)("button",{className:o().deleteButton,onClick:()=>i(e.id),children:[(0,a.jsx)(r.Xm5,{className:o().buttonIcon})," X\xf3a"]})]})]},e.id))})]})})}):(0,a.jsx)("p",{children:"Kh\xf4ng c\xf3 dữ liệu để hiển thị."})},m=n(3048),u=e=>{let{isOpen:t,onClose:n,onSave:i,initialData:l,table:r}=e,[c,u]=(0,s.useState)({}),[d,h]=(0,s.useState)(null),[p,j]=(0,s.useState)(!1),[x,g]=(0,s.useState)({x:0,y:0}),[_,b]=(0,s.useState)(!1),N=(0,s.useRef)(null);(0,s.useEffect)(()=>{l&&t?(u(l),h(l.image||null)):(u({emoji:""}),h(null))},[l,t]);let f=e=>{if("image"===e.target.name){let t=e.target.files[0];u({...c,image:t}),h(URL.createObjectURL(t))}else u({...c,[e.target.name]:e.target.value})};return t?(0,a.jsx)("div",{className:o().popupOverlay,children:(0,a.jsxs)("div",{className:o().popupWrapper,children:[(0,a.jsxs)("div",{className:o().popup,ref:N,style:{transform:"translate(".concat(x.x,"px, ").concat(x.y,"px)")},children:[(0,a.jsx)("div",{className:o().popupHeader,onMouseDown:e=>{b(!0);let t=e.clientX-x.x,n=e.clientY-x.y,a=e=>{_&&g({x:e.clientX-t,y:e.clientY-n})},s=()=>{b(!1),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",s)};window.addEventListener("mousemove",a),window.addEventListener("mouseup",s)},children:(0,a.jsxs)("h1",{style:{margin:0,flex:1,textAlign:"center"},children:[l?"Sửa":"Th\xeam"," ","times"===r?"Thời điểm":"majors"===r?"Ng\xe0nh":"technologies"===r?"C\xf4ng nghệ":"impacts"===r?"T\xe1c động":"Gợi \xfd"]})}),(0,a.jsx)("div",{className:o().formContainer,children:"outlines"===r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("label",{className:o().formLabel,children:"Bước:"}),(0,a.jsx)("input",{type:"text",name:"step",value:c.step||"",onChange:f,className:o().formInput}),(0,a.jsx)("label",{className:o().formLabel,children:"Ti\xeau đề:"}),(0,a.jsx)("input",{type:"text",name:"title",value:c.title||"",onChange:f,className:o().formInput}),(0,a.jsx)("label",{className:o().formLabel,children:"Thời gian:"}),(0,a.jsx)("input",{type:"text",name:"time",value:c.time||"",onChange:f,className:o().formInput}),(0,a.jsx)("label",{className:o().formLabel,children:"Nội dung:"}),(0,a.jsx)("textarea",{name:"content",value:c.content||"",onChange:f,className:o().formTextarea}),(0,a.jsx)("label",{className:o().formLabel,children:"Gợi \xfd:"}),(0,a.jsx)("textarea",{name:"suggest",value:c.suggest||"",onChange:f,className:o().formTextarea}),(0,a.jsxs)("label",{className:o().formLabel,children:["Chọn Emoji: "," ",(0,a.jsx)("button",{onClick:()=>j(!p),className:o().emojiButton,children:c.emoji||"Chọn"}),c.emoji&&(0,a.jsx)("button",{onClick:()=>{u({...c,emoji:""})},className:o().emojiButton,style:{marginLeft:"10px",color:"#e65a00"},children:"X\xf3a"})]}),p&&(0,a.jsx)("div",{className:o().emojiPicker,children:(0,a.jsx)(m.ZP,{onEmojiClick:e=>{u({...c,emoji:e.emoji}),j(!1)}})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("label",{className:o().formLabel,children:"Ti\xeau đề:"}),(0,a.jsx)("input",{type:"text",name:"title",value:c.title||"",onChange:f,className:o().formInput}),(0,a.jsx)("label",{className:o().formLabel,children:"H\xecnh ảnh:"}),(0,a.jsx)("input",{type:"file",name:"image",accept:"image/*",onChange:f,className:o().formInput}),d&&(0,a.jsx)("img",{src:d,alt:"Preview",className:o().imagePreview})]})}),(0,a.jsxs)("div",{className:o().popupButtons,children:[(0,a.jsx)("button",{onClick:()=>{let e=new FormData;"outlines"===r?(e.append("step",c.step||""),e.append("title",c.title||""),e.append("time",c.time||""),e.append("content",c.content||""),e.append("suggest",c.suggest||""),e.append("emoji",c.emoji||"")):(e.append("title",c.title||""),c.image instanceof File&&e.append("image",c.image));let t=null==l?void 0:l.id;t&&!isNaN(t)&&t>0&&e.append("id",t.toString()),i(e),n()},className:o().saveButton,children:"Lưu"}),(0,a.jsx)("button",{onClick:n,className:o().cancelButton,children:"Hủy"})]})]}),(0,a.jsx)("button",{className:o().closeButton,onClick:n,children:(0,a.jsx)("b",{children:"X"})})]})}):null},d=n(1502);function h(){let e=(0,i.useRouter)(),[t,n]=(0,s.useState)("times"),[l,m]=(0,s.useState)([]),[h,p]=(0,s.useState)(!1),[j,x]=(0,s.useState)(null),[g,_]=(0,s.useState)(!1),[b,N]=(0,s.useState)(!1),[f,v]=(0,s.useState)(null),[k,y]=(0,s.useState)(""),[A,C]=(0,s.useState)(""),[w,B]=(0,s.useState)("");(0,s.useEffect)(()=>{let t=localStorage.getItem("user");t?T(t):(d.Am.error("Vui l\xf2ng đăng nhập để truy cập trang admin"),e.push("/login"))},[e]);let T=async t=>{try{let e=await fetch("/api/users?username=".concat(t)),n=await e.json();if(e.ok&&n)v(n);else throw Error("Kh\xf4ng t\xecm thấy th\xf4ng tin người d\xf9ng")}catch(t){d.Am.error(t.message||"Lỗi khi lấy th\xf4ng tin người d\xf9ng"),localStorage.removeItem("user"),e.push("/login")}},L=async e=>{try{let t=await fetch("/api/".concat(e)),n=await t.json();Array.isArray(n)?m(n):(console.error("API did not return an array:",n),m([]))}catch(e){console.error("Error fetching data:",e),m([])}};(0,s.useEffect)(()=>{L(t)},[t]);let S=async e=>{try{let n=await fetch("/api/".concat(t),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}),a=await n.json();n.ok?(d.Am.success(a.message||"X\xf3a th\xe0nh c\xf4ng"),L(t)):d.Am.error(a.error||"X\xf3a thất bại")}catch(e){d.Am.error("Lỗi: "+e.message)}},I=async e=>{try{let n=await fetch("/api/".concat(t),{method:j?"PUT":"POST",body:e}),a=await n.json();n.ok?(d.Am.success(a.message||"Lưu th\xe0nh c\xf4ng"),L(t)):d.Am.error(a.error||"Lưu thất bại")}catch(e){d.Am.error("Lỗi: "+e.message)}},E=async()=>{if(A.length<8){d.Am.error("Mật khẩu mới phải c\xf3 \xedt nhất 8 k\xfd tự");return}if(A!==w){d.Am.error("Mật khẩu mới v\xe0 x\xe1c nhận mật khẩu kh\xf4ng khớp");return}try{console.log("Đang kiểm tra mật khẩu hiện tại:",{username:f.username,password:k});let e=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:f.username,password:k})}),t=await e.json();if(console.log("Kết quả kiểm tra mật khẩu:",t),!t.success){d.Am.error("Mật khẩu hiện tại kh\xf4ng đ\xfang");return}console.log("Đang cập nhật mật khẩu mới:",{id:f.id,password:A});let n=await fetch("/api/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:f.id,password:A})}),a=await n.json();console.log("Kết quả cập nhật mật khẩu:",a),n.ok?(d.Am.success("Đổi mật khẩu th\xe0nh c\xf4ng"),N(!1),y(""),C(""),B(""),T(f.username)):d.Am.error(a.error||"Đổi mật khẩu thất bại")}catch(e){console.error("Lỗi khi đổi mật khẩu:",e),d.Am.error("Lỗi: "+e.message)}};return(0,a.jsxs)("div",{className:o().container,children:[(0,a.jsxs)("header",{className:o().header,children:[(0,a.jsxs)("h1",{children:["Ch\xe0o mừng ",(null==f?void 0:f.username)||"Admin"," quay trở lại!"]}),(0,a.jsxs)("div",{className:o().headerButtons,children:[(0,a.jsxs)("button",{className:o().profileButton,onClick:()=>_(!0),children:[(0,a.jsx)(r.Xws,{className:o().buttonIcon}),"Hồ sơ"]}),(0,a.jsxs)("button",{className:o().logoutButton,onClick:()=>{localStorage.removeItem("user"),d.Am.success("Đăng xuất th\xe0nh c\xf4ng"),e.push("/")},children:[(0,a.jsx)(r.fHX,{className:o().buttonIcon})," Đăng xuất"]})]})]}),(0,a.jsxs)("div",{className:o().tabs,children:[(0,a.jsx)("button",{className:"times"===t?o().activeTab:o().tab,onClick:()=>n("times"),children:"Thời điểm"}),(0,a.jsx)("button",{className:"majors"===t?o().activeTab:o().tab,onClick:()=>n("majors"),children:"Ng\xe0nh"}),(0,a.jsx)("button",{className:"technologies"===t?o().activeTab:o().tab,onClick:()=>n("technologies"),children:"C\xf4ng nghệ"}),(0,a.jsx)("button",{className:"impacts"===t?o().activeTab:o().tab,onClick:()=>n("impacts"),children:"T\xe1c động"}),(0,a.jsx)("button",{className:"outlines"===t?o().activeTab:o().tab,onClick:()=>n("outlines"),children:"Gợi \xfd"})]}),(0,a.jsxs)("div",{className:o().tableHeader,children:[(0,a.jsxs)("h2",{children:["Danh s\xe1ch thẻ ","times"===t?"Thời điểm":"majors"===t?"Ng\xe0nh":"technologies"===t?"C\xf4ng nghệ":"impacts"===t?"T\xe1c động":"Gợi \xfd"]}),(0,a.jsxs)("button",{className:o().addButton,onClick:()=>{x(null),p(!0)},children:[(0,a.jsx)(r.wEH,{className:o().buttonIcon}),"Th\xeam"]})]}),(0,a.jsx)(c,{data:l,table:t,onEdit:e=>{console.log("Editing item:",e),x(e),p(!0)},onDelete:S}),(0,a.jsx)("div",{className:o().footerText,children:"Bản quyền thuộc về FLASH VN & được cấp ph\xe9p bởi nh\xf3m cộng đồng."}),(0,a.jsx)(u,{isOpen:h,onClose:()=>p(!1),onSave:I,initialData:j,table:t}),g&&f&&(0,a.jsx)("div",{className:o().popupOverlay,children:(0,a.jsxs)("div",{className:o().popupWrapper,children:[(0,a.jsxs)("div",{className:o().popup,children:[(0,a.jsx)("div",{className:o().popupHeader,children:(0,a.jsx)("h1",{style:{margin:0,flex:1,textAlign:"center"},children:"Hồ sơ"})}),(0,a.jsxs)("div",{className:o().formContainer,children:[(0,a.jsx)("label",{className:o().formLabel,children:"T\xean đăng nhập:"}),(0,a.jsx)("input",{type:"text",value:f.username,readOnly:!0,className:o().formInput}),(0,a.jsx)("label",{className:o().formLabel,children:"Email:"}),(0,a.jsx)("input",{type:"email",value:f.email,readOnly:!0,className:o().formInput}),(0,a.jsx)("label",{className:o().formLabel,children:"Mật khẩu:"}),(0,a.jsx)("input",{type:"text",value:"********",readOnly:!0,className:o().formInput})]}),(0,a.jsx)("div",{className:o().popupButtons,children:(0,a.jsx)("button",{className:o().editButton,onClick:()=>{_(!1),N(!0)},children:"Đổi mật khẩu"})})]}),(0,a.jsx)("button",{className:o().closeButton,onClick:()=>_(!1),children:(0,a.jsx)("b",{children:"X"})})]})}),b&&f&&(0,a.jsx)("div",{className:o().popupOverlay,children:(0,a.jsxs)("div",{className:o().popupWrapper,children:[(0,a.jsxs)("div",{className:o().popup,children:[(0,a.jsx)("div",{className:o().popupHeader,children:(0,a.jsx)("h1",{style:{margin:0,flex:1,textAlign:"center"},children:"Đổi mật khẩu"})}),(0,a.jsxs)("div",{className:o().formContainer,children:[(0,a.jsx)("label",{className:o().formLabel,children:"Mật khẩu hiện tại:"}),(0,a.jsx)("input",{type:"password",value:k,onChange:e=>y(e.target.value),className:o().formInput,placeholder:"Nhập mật khẩu hiện tại"}),(0,a.jsx)("label",{className:o().formLabel,children:"Mật khẩu mới:"}),(0,a.jsx)("input",{type:"password",value:A,onChange:e=>C(e.target.value),className:o().formInput,placeholder:"Nhập mật khẩu mới (\xedt nhất 8 k\xfd tự)"}),(0,a.jsx)("label",{className:o().formLabel,children:"X\xe1c nhận mật khẩu mới:"}),(0,a.jsx)("input",{type:"password",value:w,onChange:e=>B(e.target.value),className:o().formInput,placeholder:"X\xe1c nhận mật khẩu mới"})]}),(0,a.jsxs)("div",{className:o().popupButtons,children:[(0,a.jsx)("button",{onClick:E,className:o().saveButton,children:"X\xe1c nhận"}),(0,a.jsx)("button",{onClick:()=>N(!1),className:o().cancelButton,children:"Hủy"})]})]}),(0,a.jsx)("button",{className:o().closeButton,onClick:()=>N(!1),children:(0,a.jsx)("b",{children:"X"})})]})}),(0,a.jsx)(d.Ix,{position:"top-right",autoClose:3e3})]})}n(2130)},6808:function(e){e.exports={container:"Admin_container__UrLIB",header:"Admin_header__rN1Nl",headerButtons:"Admin_headerButtons__tN1nj",profileButton:"Admin_profileButton__I4Ii0",logoutButton:"Admin_logoutButton__dLCBu",tabs:"Admin_tabs__3vtz5",tab:"Admin_tab__qb3dA",activeTab:"Admin_activeTab__fvtdm",tableContainer:"Admin_tableContainer__jS7Fw",tableHeader:"Admin_tableHeader__TIvp7",addButton:"Admin_addButton__E1JNr",tableWrapper:"Admin_tableWrapper__QwKHH",table:"Admin_table__oQINs",actionCell:"Admin_actionCell___knVh",editButton:"Admin_editButton__2gEw6",deleteButton:"Admin_deleteButton__uxDlR",buttonIcon:"Admin_buttonIcon__wJDrd",popupOverlay:"Admin_popupOverlay__wK34Y",popupWrapper:"Admin_popupWrapper__xTWko",popup:"Admin_popup__oC1zk",popupHeader:"Admin_popupHeader__UjQ8q",closeButton:"Admin_closeButton__vEhnE",formContainer:"Admin_formContainer__ZbM4L",formLabel:"Admin_formLabel__jur44",formInput:"Admin_formInput__wFPjc",formTextarea:"Admin_formTextarea__sivJq",emojiButton:"Admin_emojiButton__GxzsF",emojiPicker:"Admin_emojiPicker__sldOd",imagePreview:"Admin_imagePreview__CW2ZO",popupButtons:"Admin_popupButtons__YVaHp",saveButton:"Admin_saveButton__KQWCK",cancelButton:"Admin_cancelButton__l1jYY",tableTitle:"Admin_tableTitle__ARLJn",qrButton:"Admin_qrButton__TcLy_",footerText:"Admin_footerText__Q9Dcs"}}},function(e){e.O(0,[365,307,242,888,774,179],function(){return e(e.s=4730)}),_N_E=e.O()}]);