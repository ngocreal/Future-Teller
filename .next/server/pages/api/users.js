"use strict";(()=>{var e={};e.id=829,e.ids=[829],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7618:e=>{e.exports=import("bcryptjs")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},9440:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>d,default:()=>c,routeModule:()=>h});var a=s(1802),n=s(7153),o=s(6249),i=s(6845),u=e([i]);i=(u.then?(await u)():u)[0];let c=(0,o.l)(i,"default"),d=(0,o.l)(i,"config"),h=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/users",pathname:"/api/users",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},1417:(e,t,s)=>{s.d(t,{Z:()=>a});let r=require("mysql2/promise"),a=s.n(r)().createPool({host:process.env.DB_HOST,port:process.env.DB_PORT,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME})},6845:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{default:()=>i});var a=s(1417),n=s(7618),o=e([n]);async function i(e,t){if("GET"===e.method){let{username:s}=e.query;try{let[e]=await a.Z.execute("SELECT id, username, email, password_hash FROM users WHERE username = ?",[s]);e.length>0?t.status(200).json(e[0]):t.status(404).json({error:"Kh\xf4ng t\xecm thấy người d\xf9ng"})}catch(e){t.status(500).json({error:"Lỗi server"})}}else if("PUT"===e.method){let{id:s,password:r}=e.body;try{let e=await n.default.genSalt(10),o=await n.default.hash(r,e),[i]=await a.Z.execute("UPDATE users SET password_hash = ? WHERE id = ?",[o,s]);i.affectedRows>0?t.status(200).json({message:"Cập nhật mật khẩu th\xe0nh c\xf4ng"}):t.status(404).json({error:"Người d\xf9ng kh\xf4ng tồn tại"})}catch(e){t.status(500).json({error:"Lỗi server"})}}else if("POST"===e.method&&"reset"===e.body.action){let{username:s,newPassword:r}=e.body;try{let e=await n.default.genSalt(10),o=await n.default.hash(r,e),[i]=await a.Z.execute("UPDATE users SET password_hash = ? WHERE username = ?",[o,s]);i.affectedRows>0?t.status(200).json({message:`Reset mật khẩu th\xe0nh c\xf4ng cho ${s}. Mật khẩu mới: ${r}`}):t.status(404).json({error:"Người d\xf9ng kh\xf4ng tồn tại"})}catch(e){t.status(500).json({error:"Lỗi server"})}}else t.status(405).json({error:"Phương thức kh\xf4ng được hỗ trợ"})}n=(o.then?(await o)():o)[0],r()}catch(e){r(e)}})},7153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var s=t(t.s=9440);module.exports=s})();