"use strict";(()=>{var t={};t.id=254,t.ids=[254],t.modules={145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(t,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function t(e,n){return n in e?e[n]:"then"in e&&"function"==typeof e.then?e.then(e=>t(e,n)):"function"==typeof e&&"default"===n?e:void 0}}})},4863:(t,e,n)=>{n.r(e),n.d(e,{config:()=>c,default:()=>d,routeModule:()=>p});var r={};n.r(r),n.d(r,{config:()=>u,default:()=>l});var s=n(1802),i=n(7153),o=n(6249),a=n(1417);let u={api:{bodyParser:!1}};async function l(t,e){let{method:n}=t,r=t=>{if(!t)return"";try{return String.fromCodePoint(...[...t].map(t=>t.codePointAt(0)))}catch(t){return"\uD83D\uDE0A"}};try{switch(n){case"GET":let[s]=await a.Z.query("SELECT * FROM outlines");e.status(200).json(s);break;case"POST":let i="";t.on("data",t=>{i+=t.toString()}),await new Promise(e=>t.on("end",e));let o={},u=t.headers["content-type"].split("boundary=")[1];for(let t of i.split(`--${u}`))if(t.includes("Content-Disposition")){let e=t.match(/name="([^"]+)"/);if(e){let n=e[1],r=t.split("\r\n\r\n")[1];if(r){let t=r.lastIndexOf("\r\n--"),e=-1!==t?r.substring(0,t).trim():r.trim();o[n]=e}}}let l=o.title;if(!l)return e.status(400).json({error:"Ti\xeau đề l\xe0 bắt buộc"});let[d]=await a.Z.query("SELECT * FROM outlines WHERE title = ?",[l]);if(d.length>0)return e.status(400).json({error:"Ti\xeau đề đ\xe3 tồn tại"});let c=r(o.emoji);await a.Z.query("INSERT INTO outlines (step, title, time, content, suggest, emoji) VALUES (?, ?, ?, ?, ?, ?)",[o.step||"",l,o.time||"",o.content||"",o.suggest||"",c]),e.status(201).json({message:"Th\xeam th\xe0nh c\xf4ng"});break;case"PUT":let p="";t.on("data",t=>{p+=t.toString()}),await new Promise(e=>t.on("end",e));let f={},E=t.headers["content-type"].split("boundary=")[1];for(let t of p.split(`--${E}`))if(t.includes("Content-Disposition")){let e=t.match(/name="([^"]+)"/);if(e){let n=e[1],r=t.split("\r\n\r\n")[1];if(r){let t=r.lastIndexOf("\r\n--"),e=-1!==t?r.substring(0,t).trim():r.trim();f[n]=e}}}let m=f.id,P=f.title;if(!m)return e.status(400).json({error:"Thiếu id trong body"});if(!P)return e.status(400).json({error:"Ti\xeau đề l\xe0 bắt buộc"});let[g]=await a.Z.query("SELECT * FROM outlines WHERE title = ? AND id != ?",[P,m]);if(g.length>0)return e.status(400).json({error:"Ti\xeau đề đ\xe3 tồn tại"});let T=r(f.emoji);await a.Z.query("UPDATE outlines SET step = ?, title = ?, time = ?, content = ?, suggest = ?, emoji = ? WHERE id = ?",[f.step||"",P,f.time||"",f.content||"",f.suggest||"",T,m]),e.status(200).json({message:"Sửa th\xe0nh c\xf4ng"});break;case"DELETE":let h="";t.on("data",t=>{h+=t.toString()}),await new Promise(e=>t.on("end",e));let A=(h?JSON.parse(h):{}).id;if(!A)return e.status(400).json({error:"Thiếu id trong body"});await a.Z.query("DELETE FROM outlines WHERE id = ?",[A]),e.status(200).json({message:"X\xf3a th\xe0nh c\xf4ng"});break;default:e.setHeader("Allow",["GET","POST","PUT","DELETE"]),e.status(405).end(`Method ${n} Not Allowed`)}}catch(t){e.status(500).json({error:t.message})}}let d=(0,o.l)(r,"default"),c=(0,o.l)(r,"config"),p=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/outlines",pathname:"/api/outlines",bundlePath:"",filename:""},userland:r})},1417:(t,e,n)=>{n.d(e,{Z:()=>s});let r=require("mysql2/promise"),s=n.n(r)().createPool({host:process.env.DB_HOST,port:process.env.DB_PORT,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME})},7153:(t,e)=>{var n;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return n}}),function(t){t.PAGES="PAGES",t.PAGES_API="PAGES_API",t.APP_PAGE="APP_PAGE",t.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(t,e,n)=>{t.exports=n(145)}};var e=require("../../webpack-api-runtime.js");e.C(t);var n=e(e.s=4863);module.exports=n})();