"use strict";(()=>{var e={};e.id=910,e.ids=[910],e.modules={1738:e=>{e.exports=require("multer")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})},1335:(e,t,i)=>{i.r(t),i.d(t,{config:()=>P,default:()=>h,routeModule:()=>T});var a={};i.r(a),i.d(a,{config:()=>m,default:()=>f});var n=i(1802),r=i(7153),s=i(6249),o=i(1417),l=i(1738),u=i.n(l),c=i(7147),d=i(1017),E=i.n(d);let g=u()({storage:u().diskStorage({destination:"./public/uploads/",filename:(e,t,i)=>{i(null,Date.now()+"-"+Math.round(1e9*Math.random())+E().extname(t.originalname))}})}),p=(e,t,i)=>new Promise((a,n)=>{i(e,t,e=>e instanceof Error?n(e):a(e))}),m={api:{bodyParser:!1}};async function f(e,t){let{method:i}=e;try{switch(i){case"GET":let[a]=await o.Z.query("SELECT * FROM technologies");t.status(200).json(a);break;case"POST":await p(e,t,g.single("image"));let{title:n}=e.body,[r]=await o.Z.query("SELECT * FROM technologies WHERE title = ?",[n]);if(r.length>0)return t.status(400).json({error:"Ti\xeau đề đ\xe3 tồn tại"});let s=e.file?`/uploads/${e.file.filename}`:null;await o.Z.query("INSERT INTO technologies (title, image) VALUES (?, ?)",[n,s]),t.status(201).json({message:"Th\xeam th\xe0nh c\xf4ng"});break;case"PUT":await p(e,t,g.single("image"));let{id:l,title:u}=e.body,[d]=await o.Z.query("SELECT * FROM technologies WHERE title = ? AND id != ?",[u,l]);if(d.length>0)return t.status(400).json({error:"Ti\xeau đề đ\xe3 tồn tại"});let[m]=await o.Z.query("SELECT image FROM technologies WHERE id = ?",[l]);if(e.file&&m[0]?.image){let e=E().join(process.cwd(),"public",m[0].image);await c.promises.unlink(e).catch(()=>{})}let f=e.file?`/uploads/${e.file.filename}`:m[0]?.image;await o.Z.query("UPDATE technologies SET title = ?, image = ? WHERE id = ?",[u,f,l]),t.status(200).json({message:"Sửa th\xe0nh c\xf4ng"});break;case"DELETE":let h="";e.on("data",e=>{h+=e.toString()}),await new Promise(t=>e.on("end",t));let{id:P}=h?JSON.parse(h):{};if(!P)return t.status(400).json({error:"Thiếu id trong body"});let[T]=await o.Z.query("SELECT image FROM technologies WHERE id = ?",[P]);if(T[0]?.image){let e=E().join(process.cwd(),"public",T[0].image);await c.promises.unlink(e).catch(()=>{})}await o.Z.query("DELETE FROM technologies WHERE id = ?",[P]),t.status(200).json({message:"X\xf3a th\xe0nh c\xf4ng"});break;default:t.setHeader("Allow",["GET","POST","PUT","DELETE"]),t.status(405).end(`Method ${i} Not Allowed`)}}catch(e){t.status(500).json({error:e.message})}}let h=(0,s.l)(a,"default"),P=(0,s.l)(a,"config"),T=new n.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/technologies",pathname:"/api/technologies",bundlePath:"",filename:""},userland:a})},1417:(e,t,i)=>{i.d(t,{Z:()=>n});let a=require("mysql2/promise"),n=i.n(a)().createPool({host:process.env.DB_HOST,port:process.env.DB_PORT,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME})},7153:(e,t)=>{var i;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))},1802:(e,t,i)=>{e.exports=i(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var i=t(t.s=1335);module.exports=i})();