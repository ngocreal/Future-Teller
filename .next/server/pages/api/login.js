"use strict";(()=>{var e={};e.id=994,e.ids=[994],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7618:e=>{e.exports=import("bcryptjs")},6249:(e,s)=>{Object.defineProperty(s,"l",{enumerable:!0,get:function(){return function e(s,t){return t in s?s[t]:"then"in s&&"function"==typeof s.then?s.then(s=>e(s,t)):"function"==typeof s&&"default"===t?s:void 0}}})},1688:(e,s,t)=>{t.a(e,async(e,o)=>{try{t.r(s),t.d(s,{config:()=>l,default:()=>i,routeModule:()=>d});var r=t(1802),n=t(7153),a=t(6249),u=t(4363),c=e([u]);u=(c.then?(await c)():c)[0];let i=(0,a.l)(u,"default"),l=(0,a.l)(u,"config"),d=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/login",pathname:"/api/login",bundlePath:"",filename:""},userland:u});o()}catch(e){o(e)}})},1417:(e,s,t)=>{t.d(s,{Z:()=>r});let o=require("mysql2/promise"),r=t.n(o)().createPool({host:process.env.DB_HOST,port:process.env.DB_PORT,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME})},4363:(e,s,t)=>{t.a(e,async(e,o)=>{try{t.r(s),t.d(s,{default:()=>u});var r=t(1417),n=t(7618),a=e([n]);async function u(e,s){if(console.log("\uD83D\uDC49 Login request:",e.method,e.body),"POST"!==e.method)return s.status(405).json({success:!1,message:"Method Not Allowed"});let{username:t,password:o}=e.body;try{let[e]=await r.Z.execute("SELECT username, password_hash FROM users WHERE username = ?",[t]);if(console.log("    → DB rows:",e),0===e.length)return s.status(401).json({success:!1,message:"Sai username hoặc password",reason:"no_user"});let{password_hash:a}=e[0];console.log("    → Stored hash:",a);let u=await n.default.compare(o,a);if(console.log("    → Password match?",u),!u)return s.status(401).json({success:!1,message:"Sai username hoặc password",reason:"bad_password"});return console.log("Login successful for",t),s.status(200).json({success:!0,message:"Đăng nhập th\xe0nh c\xf4ng"})}catch(e){return console.error("Login error:",e),s.status(500).json({success:!1,message:"Lỗi server"})}}n=(a.then?(await a)():a)[0],o()}catch(e){o(e)}})},7153:(e,s)=>{var t;Object.defineProperty(s,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,s,t)=>{e.exports=t(145)}};var s=require("../../webpack-api-runtime.js");s.C(e);var t=s(s.s=1688);module.exports=t})();